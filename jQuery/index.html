<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>豆瓣电影</title>
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1071295_p6wti66tqj.css">
  <link rel="stylesheet" href="main.css">
</head>

<body>
  <main>
    <section>

    </section>
    <section>tab2</section>
    <section>tab3</section>
  </main>
  <footer>
    <div class="active"><span class="iconfont icon-top250"></span><span>Top250</span></div>
    <div><span class="iconfont icon-us"></span><span>北美</span></div>
    <div><span class="iconfont icon-search"></span><span>搜索</span></div>
  </footer>






  <script src="../node_modules/eruda/eruda.min.js"></script>
  <script>
    eruda.init();
  </script>
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
  <script>
    $('footer>div').click(function () {
      var index = $(this).index()
      $('section').hide().eq(index).fadeIn()
      $(this).addClass('active').siblings().removeClass('active')
    })

    function template() {
      return `<div class="item">
        <a href="#">
            <div class="cover">
              <img src="" alt="">
            </div>
            <div class="detail">
            <div class="headline">
              <h2></h2>
              <div class="extra original_title"></div>
            </div>
            <div class="extra"><span class="score"></span><span class="xxx">分</span> / <span class="collect">xxx</span>收藏 </div>
            <div class="extra"><span class="year">2019</span>年 / <span class="type"></div>
            <div class="extra">导演：<span class="director">yyy</div>
            <div class="extra">主演：<span class="actor">aaa、bbb、ccc</span></div>
          </div>
        </a>
      </div>`
    }

    $.ajax({
      url: 'http://api.douban.com/v2/movie/top250',
      type: 'GET',
      data: {
        start: 0,
        count: 20
      },
      dataType: 'jsonp'
    }).done(function (ret) {
      console.log(ret)
      var tmpl = template()
      setData(ret, tmpl, textNode)
    }).fail(function () {
      console.log('error……')
    })

    function setData(data, tmpl, fillData) {
      data.subjects.forEach(movie => {
        var $node = $(tmpl)
        fillData($node, '.cover img', '', movie.images.small)
        fillData($node, '.detail h2', movie.title)
        fillData($node, '.original_title', ` / ${movie.original_title}`)
        fillData($node, '.score', movie.rating.average)
        fillData($node, '.collect', movie.collect_count)
        fillData($node, '.year', movie.year)
        fillData($node, '.type', movie.genres.join(' / '))
        fillData($node, '.director', () => {
          var directorsArr = []
          movie.directors.forEach((item) => {
            directorsArr.push(item.name)
          })
          return directorsArr.join('、')
        })
        fillData($node, '.actor', () => {
          var actorArr = []
          movie.casts.forEach((item) => {
            actorArr.push(item.name)
          })
          return actorArr.join('、')
        })
        $('section').eq(0).append($node)
      })
    }

    function textNode($tmplNode, selector, textData, srcData) {
      if (arguments[2] !== '') {
        $tmplNode.find(selector).text(textData)
      } else {
        $tmplNode.find(selector).attr('src', srcData)
      }
    }
  </script>
</body>

</html>